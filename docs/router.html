<!DOCTYPE html>

<html>
<head>
  <title>Chip Routing</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="binders.html">
                  binders.js
                </a>
              
                
                <a class="source" href="chip.html">
                  chip.js
                </a>
              
                
                <a class="source" href="controller.html">
                  controller.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = Router;
Router.Route = Route;
<span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./events'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="chip-routing">Chip Routing</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Work inspired by and in some cases based off of work done for Express.js (<a href="https://github.com/visionmedia/express">https://github.com/visionmedia/express</a>)
Events: error, change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Router</span>(<span class="hljs-params"></span>) </span>{
  EventEmitter.call(<span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">this</span>.routes = [];
  <span class="hljs-keyword">this</span>.params = {};
  <span class="hljs-keyword">this</span>.paramsExp = {};
  <span class="hljs-keyword">this</span>.prefix = <span class="hljs-string">''</span>;
}

Router.prototype = <span class="hljs-built_in">Object</span>.create(EventEmitter.prototype);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Registers a <code>callback</code> function to be called when the given param <code>name</code> is matched in a URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Router.prototype.param = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, callback</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span>) {
    (<span class="hljs-keyword">this</span>.params[name] || (<span class="hljs-keyword">this</span>.params[name] = [])).push(callback);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (callback <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
    <span class="hljs-keyword">this</span>.paramsExp[name] = callback;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'param must have a callback of type "function" or RegExp. Got '</span> + callback + <span class="hljs-string">'.'</span>);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Registers a <code>callback</code> function to be called when the given path matches a URL. The callback receives two
arguments, <code>req</code>, and <code>next</code>, where <code>req</code> represents the request and has the properties, <code>url</code>, <code>path</code>, <code>params</code>
and <code>query</code>. <code>req.params</code> is an object with the parameters from the path (e.g. /:username/<em> would make a params
object with two properties, <code>username</code> and `</em><code>).</code>req.query` is an object with key-value pairs from the query
portion of the URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Router.prototype.route = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">path, callback</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'route must have a callback of type "function". Got '</span> + callback + <span class="hljs-string">'.'</span>);
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path === <span class="hljs-string">'string'</span>) {
    path = <span class="hljs-string">'/'</span> + path;
    path = path.replace(<span class="hljs-regexp">/\/{2,}/g</span>, <span class="hljs-string">'/'</span>);
  }
  <span class="hljs-keyword">this</span>.routes.push(<span class="hljs-keyword">new</span> Route(path, callback));
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};


Router.prototype.redirect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url, replace</span>) </span>{
  <span class="hljs-keyword">if</span> (url.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">'.'</span> || url.split(<span class="hljs-string">'//'</span>).length &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">var</span> pathParts = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);
    pathParts.href = url;
    url = pathname(pathParts) + pathParts.search;
  } <span class="hljs-keyword">else</span> {
    url = <span class="hljs-keyword">this</span>.prefix + url;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentUrl === url) {
    <span class="hljs-keyword">return</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Redirects if the url isn’t at this page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hashOnly &amp;&amp; <span class="hljs-keyword">this</span>.root &amp;&amp; url.indexOf(<span class="hljs-keyword">this</span>.root) !== <span class="hljs-number">0</span>) {
    location.href = url;
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">var</span> notFound = <span class="hljs-literal">false</span>;
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errHandler</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.detail === <span class="hljs-string">'notFound'</span>) {
      notFound = <span class="hljs-literal">true</span>;
    }
  }
  <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'error'</span>, errHandler);

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.usePushState) {
    <span class="hljs-keyword">if</span> (replace) {
      history.replaceState({}, <span class="hljs-string">''</span>, url);
    } <span class="hljs-keyword">else</span> {
      history.pushState({}, <span class="hljs-string">''</span>, url);
    }
    <span class="hljs-keyword">this</span>.currentUrl = url;
    <span class="hljs-keyword">this</span>.dispatch(url);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hashOnly) {
      url = url.replace(<span class="hljs-keyword">this</span>.root, <span class="hljs-string">''</span>);
      <span class="hljs-keyword">if</span> (url.charAt(<span class="hljs-number">0</span>) !== <span class="hljs-string">'/'</span>) {
        url = <span class="hljs-string">'/'</span> + url;
      }
    }
    location.hash = (url === <span class="hljs-string">'/'</span> ? <span class="hljs-string">''</span> : <span class="hljs-string">'#'</span> + url);
  }

  <span class="hljs-keyword">this</span>.off(<span class="hljs-string">'error'</span>, errHandler);
  <span class="hljs-keyword">return</span> !notFound;
};


Router.prototype.listen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-keyword">if</span> (!options) {
    options = {};
  }
  <span class="hljs-keyword">if</span> (options.stop) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._handleChange) {
      <span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">'popstate'</span>, <span class="hljs-keyword">this</span>._handleChange);
      <span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">'hashChange'</span>, <span class="hljs-keyword">this</span>._handleChange);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }

  <span class="hljs-keyword">if</span> (options.root != <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.root = options.root;
  <span class="hljs-keyword">if</span> (options.prefix != <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.prefix = options.prefix;
  <span class="hljs-keyword">if</span> (options.hashOnly != <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.hashOnly = options.hashOnly;
  <span class="hljs-keyword">this</span>.usePushState = !<span class="hljs-keyword">this</span>.hashOnly &amp;&amp; <span class="hljs-built_in">window</span>.history &amp;&amp; <span class="hljs-built_in">window</span>.history.pushState &amp;&amp; <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.root == <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-keyword">this</span>.usePushState) <span class="hljs-keyword">this</span>.hashOnly = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasOnly) <span class="hljs-keyword">this</span>.prefix = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> eventName, getUrl;

  <span class="hljs-keyword">this</span>._handleChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> url = getUrl();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentUrl === url) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">this</span>.currentUrl = url;
    <span class="hljs-keyword">this</span>.dispatch(url);
  }.bind(<span class="hljs-keyword">this</span>);


  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.usePushState) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Fix the URL if linked with a hash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (location.hash) {
      url = location.pathname.replace(<span class="hljs-regexp">/\/$/</span>, <span class="hljs-string">''</span>) + location.hash.replace(<span class="hljs-regexp">/^#?\/?/</span>, <span class="hljs-string">'/'</span>);
      history.replaceState({}, <span class="hljs-string">''</span>, url);
    }

    eventName = <span class="hljs-string">'popstate'</span>;
    getUrl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> location.pathname + location.search;
    };
  } <span class="hljs-keyword">else</span> {

    eventName = <span class="hljs-string">'hashchange'</span>;
    getUrl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> location.hash.replace(<span class="hljs-regexp">/^#\/?/</span>, <span class="hljs-string">'/'</span>) || <span class="hljs-string">'/'</span>;
    };
  }

  <span class="hljs-built_in">window</span>.addEventListener(eventName, <span class="hljs-keyword">this</span>._handleChange);

  <span class="hljs-keyword">this</span>._handleChange();
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};


<span class="hljs-keyword">var</span> urlParts = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);

Router.prototype.getUrlParts = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) </span>{
  urlParts.href = url;
  <span class="hljs-keyword">var</span> path = pathname(urlParts);
  <span class="hljs-keyword">if</span> (path.indexOf(<span class="hljs-keyword">this</span>.prefix) !== <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
  path = path.replace(<span class="hljs-keyword">this</span>.prefix, <span class="hljs-string">''</span>);
  <span class="hljs-keyword">if</span> (path.charAt(<span class="hljs-number">0</span>) !== <span class="hljs-string">'/'</span>) {
    path = <span class="hljs-string">'/'</span> + path;
  }
  <span class="hljs-keyword">return</span> { path: path, query: urlParts.search };
};


Router.prototype.getRoutesMatchingPath = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">if</span> (path == <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> [];
  }
  <span class="hljs-keyword">var</span> paramsExp = <span class="hljs-keyword">this</span>.paramsExp;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.routes.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">route</span>) </span>{
    <span class="hljs-keyword">if</span> (!route.match(path)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(route.params).every(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
      <span class="hljs-keyword">var</span> value = route.params[key];
      <span class="hljs-keyword">return</span> !paramsExp.hasOwnProperty(key) || paramsExp[key].text(value);
    });
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Dispatches all callbacks which match the <code>url</code>. <code>url</code> should be the full pathname of the location and should not
be used by your application. Use <code>redirect()</code> instead.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Router.prototype.dispatch = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) </span>{
  <span class="hljs-keyword">var</span> urlParts = <span class="hljs-keyword">this</span>.getUrlParts(url);
  <span class="hljs-keyword">if</span> (!urlParts) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">var</span> path = urlParts.path;
  <span class="hljs-keyword">var</span> req = { url: url, path: path, query: parseQuery(urlParts.query) };
  <span class="hljs-keyword">this</span>.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">'change'</span>, { detail: path }));

  <span class="hljs-keyword">var</span> routes = <span class="hljs-keyword">this</span>.getRoutesMatchingPath(path);
  <span class="hljs-keyword">var</span> callbacks = [];
  <span class="hljs-keyword">var</span> params = <span class="hljs-keyword">this</span>.params;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Add all the callbacks for this URL (all matching routes and the params they’re dependent on)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  routes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">route</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>set the params on the req object first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    callbacks.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, next</span>) </span>{
      req.params = route.params;
      next();
    });

    <span class="hljs-built_in">Object</span>.keys(route.params).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
      <span class="hljs-keyword">var</span> paramCallbacks = route.params[key];
      <span class="hljs-keyword">if</span> (paramCallbacks) {
        callbacks.push.apply(callbacks, paramCallbacks);
      }
    });

    callbacks.push(route.callback);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Calls each callback one by one until either there is an error or we call all of them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> next = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">this</span>.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">'error'</span>, { detail: err }));
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (!callbacks.length) {
      <span class="hljs-keyword">return</span> next(<span class="hljs-string">'notFound'</span>);
    }

    callback = callbacks.shift();
    callback(req, next);
  }.bind(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Start running the callbacks, one by one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (callbacks.length === <span class="hljs-number">0</span>) {
    next(<span class="hljs-string">'notFound'</span>);
  } <span class="hljs-keyword">else</span> {
    next();
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Defines a central routing object which handles all URL changes and routes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Route</span>(<span class="hljs-params">path, callback</span>) </span>{
  <span class="hljs-keyword">this</span>.path = path;
  <span class="hljs-keyword">this</span>.callback = callback;
  <span class="hljs-keyword">this</span>.keys = [];
  <span class="hljs-keyword">this</span>.expr = parsePath(path, <span class="hljs-keyword">this</span>.keys);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Determines whether route matches path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Route.prototype.match = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">var</span> match = <span class="hljs-keyword">this</span>.expr.exec(path);
  <span class="hljs-keyword">if</span> (!match) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">this</span>.params = {};

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; match.length; i++) {
    <span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.keys[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> value = match[i];

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span>) {
      value = <span class="hljs-built_in">decodeURIComponent</span>(value);
    }

    <span class="hljs-keyword">if</span> (!key) {
      key = <span class="hljs-string">'*'</span>;
    }

    <span class="hljs-keyword">this</span>.params[key] = value;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Normalizes the given path string, returning a regular expression.</p>
<p>An empty array should be passed, which will contain the placeholder key names. For example <code>&quot;/user/:id&quot;</code> will then
contain <code>[&quot;id&quot;]</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parsePath</span>(<span class="hljs-params">path, keys</span>) </span>{
  <span class="hljs-keyword">if</span> (path <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
    <span class="hljs-keyword">return</span> path;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(path)) {
    path = <span class="hljs-string">'('</span> + path.join(<span class="hljs-string">'|'</span>) + <span class="hljs-string">')'</span>;
  }

  path = path
    .concat(<span class="hljs-string">'/?'</span>)
    .replace(<span class="hljs-regexp">/\/\(/g</span>, <span class="hljs-string">'(?:/'</span>)
    .replace(<span class="hljs-regexp">/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_, slash, format, key, capture, optional, star</span>) </span>{
      keys.push(key);
      slash = slash || <span class="hljs-string">''</span>;
      <span class="hljs-keyword">var</span> expr = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">if</span> (!optional) expr += slash;
      expr += <span class="hljs-string">'(?:'</span>;
      <span class="hljs-keyword">if</span> (optional) expr += slash;
      expr += format || <span class="hljs-string">''</span>;
      expr += capture || (format &amp;&amp; <span class="hljs-string">'([^/.]+?)'</span> || <span class="hljs-string">'([^/]+?)'</span>) + <span class="hljs-string">')'</span>;
      expr += optional || <span class="hljs-string">''</span>;
      <span class="hljs-keyword">if</span> (star) expr += <span class="hljs-string">'(/*)?'</span>;
      <span class="hljs-keyword">return</span> expr;
    })
    .replace(<span class="hljs-regexp">/([\/.])/g</span>, <span class="hljs-string">'\\$1'</span>)
    .replace(<span class="hljs-regexp">/\*/g</span>, <span class="hljs-string">'(.*)'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'^'</span> + path + <span class="hljs-string">'$'</span>, <span class="hljs-string">'i'</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Parses a location.search string into an object with key-value pairs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseQuery</span>(<span class="hljs-params">search</span>) </span>{
  <span class="hljs-keyword">var</span> query = {};
  <span class="hljs-keyword">if</span> (search === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> query;
  }

  search.replace(<span class="hljs-regexp">/^\?/</span>, <span class="hljs-string">''</span>).split(<span class="hljs-string">'&amp;'</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">keyValue</span>) </span>{
    <span class="hljs-keyword">var</span> parts = keyValue.split(<span class="hljs-string">'='</span>);
    <span class="hljs-keyword">var</span> key = parts[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> value = parts[<span class="hljs-number">1</span>];
    query[<span class="hljs-built_in">decodeURIComponent</span>(key)] = <span class="hljs-built_in">decodeURIComponent</span>(value);
  });

  <span class="hljs-keyword">return</span> query;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Fix IE’s missing slash prefix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pathname</span>(<span class="hljs-params">anchor</span>) </span>{
  <span class="hljs-keyword">var</span> path = anchor.pathname;
  <span class="hljs-keyword">if</span> (path.charAt(<span class="hljs-number">0</span>) !== <span class="hljs-string">'/'</span>) {
    path = <span class="hljs-string">'/'</span> + path;
  }
  <span class="hljs-keyword">return</span> path;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
