<!DOCTYPE html>

<html>
<head>
  <title>Chip App</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="chip.html">
                  chip.js
                </a>
              
                
                <a class="source" href="fragments.html">
                  fragments.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = App;
<span class="hljs-keyword">var</span> componentBinding = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fragments-built-ins/binders/component'</span>);
<span class="hljs-keyword">var</span> Location = <span class="hljs-built_in">require</span>(<span class="hljs-string">'routes-js'</span>).Location;
<span class="hljs-keyword">var</span> EventTarget = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chip-utils/event-target'</span>);
<span class="hljs-keyword">var</span> createFragments = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./fragments'</span>);
<span class="hljs-keyword">var</span> defaultMixin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./mixins/default'</span>);
<span class="hljs-keyword">var</span> slice = <span class="hljs-built_in">Array</span>.prototype.slice;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="chip-app">Chip App</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>An App represents an app or module that can have routes, controllers, and templates defined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params">options</span>) </span>{
  options = options || {};
  EventTarget.call(<span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">this</span>.fragments = createFragments();
  <span class="hljs-keyword">this</span>.fragments.app = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">this</span>.location = Location.create(options);
  <span class="hljs-keyword">this</span>.defaultMixin = defaultMixin(<span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">this</span>._listening = <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">this</span>.rootElement = options.rootElement || <span class="hljs-built_in">document</span>.documentElement;
  <span class="hljs-keyword">this</span>.sync = <span class="hljs-keyword">this</span>.fragments.sync;
  <span class="hljs-keyword">this</span>.syncNow = <span class="hljs-keyword">this</span>.fragments.syncNow;
  <span class="hljs-keyword">this</span>.afterSync = <span class="hljs-keyword">this</span>.fragments.afterSync;
  <span class="hljs-keyword">this</span>.onSync = <span class="hljs-keyword">this</span>.fragments.onSync;
  <span class="hljs-keyword">this</span>.offSync = <span class="hljs-keyword">this</span>.fragments.offSync;
  <span class="hljs-keyword">this</span>.observe = <span class="hljs-keyword">this</span>.fragments.observe.bind(<span class="hljs-keyword">this</span>.fragments);
  <span class="hljs-keyword">this</span>.location.on(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.sync);
}

EventTarget.extend(App, {

  init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.inited) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.readyState === <span class="hljs-string">'loading'</span>) {
      <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">this</span>.init.bind(<span class="hljs-keyword">this</span>, root));
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">this</span>.inited = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">if</span> (root) {
      <span class="hljs-keyword">this</span>.rootElement = root;
    }

    <span class="hljs-keyword">this</span>.fragments.bindElement(<span class="hljs-keyword">this</span>.rootElement, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="components">Components</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Registers a new component by name with the given definition. provided <code>content</code> string. If no <code>content</code> is given
then returns a new instance of a defined template. This instance is a document fragment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  component: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, definition</span>) </span>{
    <span class="hljs-keyword">var</span> definitions = slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
    definitions.unshift(<span class="hljs-keyword">this</span>.defaultMixin);
    <span class="hljs-keyword">this</span>.fragments.registerElement(name, componentBinding.apply(<span class="hljs-literal">null</span>, definitions));
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Redirects to the provided URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  redirect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.location.url = url;
  },


  get listening() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._listening;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Listen to URL changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  listen: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> app = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>._listening = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.readyState === <span class="hljs-string">'loading'</span>) {
      <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">this</span>.listen.bind(<span class="hljs-keyword">this</span>));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Add handler for when the route changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._locationChangeHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
      app.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">'urlChange'</span>, { detail: event.detail }));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Add handler for clicking links</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._clickHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
      <span class="hljs-keyword">var</span> anchor;
      <span class="hljs-keyword">if</span> ( !(anchor = event.target.closest(<span class="hljs-string">'a[href]'</span>)) ) {
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (event.defaultPrevented) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>if something else already handled this, we won’t</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">var</span> linkHost = anchor.host.replace(<span class="hljs-regexp">/:80$|:443$/</span>, <span class="hljs-string">''</span>);
      <span class="hljs-keyword">var</span> url = anchor.getAttribute(<span class="hljs-string">'href'</span>).replace(<span class="hljs-regexp">/^#/</span>, <span class="hljs-string">''</span>);

      <span class="hljs-keyword">if</span> (linkHost &amp;&amp; linkHost !== location.host) {
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (event.metaKey || event.ctrlKey || anchor.hasAttribute(<span class="hljs-string">'target'</span>)) {
        <span class="hljs-keyword">return</span>;
      }

      event.preventDefault();
      <span class="hljs-keyword">if</span> (anchor.href === location.href + <span class="hljs-string">'#'</span>) {
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (!anchor.disabled) {
        app.redirect(url);
      }
    };

    <span class="hljs-keyword">this</span>.location.on(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>._locationChangeHandler);
    <span class="hljs-keyword">this</span>.rootElement.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>._clickHandler);
    <span class="hljs-keyword">this</span>.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">'urlChange'</span>, { detail: { url: <span class="hljs-keyword">this</span>.location.url }}));
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Stop listening</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  stop: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.location.off(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>._locationChangeHandler);
    <span class="hljs-keyword">this</span>.rootElement.removeEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>._clickHandler);
  }

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
