/*! chip 2013-10-10 */
var Path={version:"0.8.4",map:function(a){return Path.routes.defined.hasOwnProperty(a)?Path.routes.defined[a]:new Path.core.route(a)},root:function(a){Path.routes.root=a},rescue:function(a){Path.routes.rescue=a},history:{initial:{},pushState:function(a,b,c){Path.history.supported?(history.pushState(a,b,c),Path.dispatch(c)):Path.history.fallback&&(window.location.hash="#"+c)},popState:function(){var a=!Path.history.initial.popped&&location.href==Path.history.initial.URL;Path.history.initial.popped=!0,a||Path.dispatch(document.location.pathname)},listen:function(a){if(Path.history.supported=!(!window.history||!window.history.pushState),Path.history.fallback=a,Path.history.supported)Path.history.initial.popped="state"in window.history,Path.history.initial.URL=location.href,window.onpopstate=Path.history.popState;else if(Path.history.fallback){for(route in Path.routes.defined)"#"!=route.charAt(0)&&(Path.routes.defined["#"+route]=Path.routes.defined[route],Path.routes.defined["#"+route].path="#"+route);Path.listen()}}},match:function(a,b){var c,d,e,f,g,h={},i=null;for(i in Path.routes.defined)if(null!==i&&void 0!==i)for(i=Path.routes.defined[i],c=i.partition(),f=0;f<c.length;f++){if(d=c[f],g=a,d.search(/:/)>0)for(e=0;e<d.split("/").length;e++)e<g.split("/").length&&":"===d.split("/")[e].charAt(0)&&(h[d.split("/")[e].replace(/:/,"")]=g.split("/")[e],g=g.replace(g.split("/")[e],d.split("/")[e]));if(d===g)return b&&(i.params=h),i}return null},dispatch:function(a){var b,c;if(Path.routes.current!==a){if(Path.routes.previous=Path.routes.current,Path.routes.current=a,c=Path.match(a,!0),Path.routes.previous&&(b=Path.match(Path.routes.previous),null!==b&&null!==b.do_exit&&b.do_exit()),null!==c)return c.run(),Path.onchange&&Path.onchange(b,c),!0;null!==Path.routes.rescue&&Path.routes.rescue(),Path.onchange&&Path.onchange(b,c)}},listen:function(){var a=function(){Path.dispatch(location.hash)};""===location.hash&&null!==Path.routes.root&&(location.hash=Path.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=a:setInterval(a,50),""!==location.hash&&Path.dispatch(location.hash)},core:{route:function(a){this.path=a,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},Path.routes.defined[a]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};Path.core.route.prototype={to:function(a){return this.action=a,this},enter:function(a){return a instanceof Array?this.do_enter=this.do_enter.concat(a):this.do_enter.push(a),this},exit:function(a){return this.do_exit=a,this},partition:function(){for(var a,b,c=[],d=[],e=/\(([^}]+?)\)/g;a=e.exec(this.path);)c.push(a[1]);for(d.push(this.path.split("(")[0]),b=0;b<c.length;b++)d.push(d[d.length-1]+c[b]);return d},run:function(){var a,b,c=!1;if(Path.routes.defined[this.path].hasOwnProperty("do_enter")&&Path.routes.defined[this.path].do_enter.length>0)for(a=0;a<Path.routes.defined[this.path].do_enter.length;a++)if(b=Path.routes.defined[this.path].do_enter[a].apply(this,null),b===!1){c=!0;break}c||Path.routes.defined[this.path].action()}},function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return m=[],a.observers=m,setTimeout(function(){return m.calcSplices=g,m.diffObjects=j}),m.add=function(a,b,c){var d,e;return"function"==typeof b&&(c=b,b=!1),e=a(),d={expr:a,callback:c,oldValue:i(e),close:function(){return m.remove(d)}},m.push(d),b&&c(e),d},m.remove=function(a){var b;return b=m.indexOf(a),b?m.splice(b,1):void 0},m.sync=function(){return m.forEach(function(a){var b,c,d;if(d=a.expr(),Array.isArray(d)&&Array.isArray(a.oldValue))c=g(d,a.oldValue),c.length&&a.callback(d,c);else if(d&&a.oldValue&&"object"==typeof d&&"object"==typeof a.oldValue)b=j(d,a.oldValue),b.length&&a.callback(d,b);else{if(d===a.oldValue)return;a.callback(d)}a.oldValue=i(d)})},i=function(a){return Array.isArray(a)?a.slice():a&&"object"==typeof a?h(a):a},j=function(a,b){var c,d,e,f;c=[];for(f in b)e=b[f],d=a[f],(void 0===d||d!==e)&&(f in a?d!==e&&c.push(k(a,"updated",f,e)):c.push(k(a,"deleted",f,e)));for(f in a)d=a[f],f in b||c.push(k(a,"new",f));return Array.isArray(a)&&a.length!==b.length&&c.push(k(a,"updated","length",b.length)),c},k=function(a,b,c,d){return{object:a,type:b,name:c,oldValue:d}},h=function(a){var b,c,d;b=Array.isArray(a)?[]:{};for(c in b)d=b[c],b[c]=d;return Array.isArray(a)&&(b.length=a.length),b},d=0,e=1,b=2,c=3,g=function(a,g){var h,i,j,k,m,q,r,s,t,u,v,w,x,y,z,A;if(i=0,h=a.length,s=0,q=g.length,m=Math.min(h,q),v=n(a,g,m),y=o(a,g,m-v),i+=v,s+=v,h-=y,q-=y,0===h-i&&0===q-s)return[];if(i===h)return[l(i,g.slice(s,q),0)];if(s===q)return[l(i,[],h-i)];for(j=f(a,i,h,g,s,q),u=p(j),w=void 0,x=[],k=i,r=s,z=0,A=u.length;A>z;z++)t=u[z],t===d?(w&&(x.push(w),w=void 0),k++,r++):t===e?(w||(w=l(k,[],0)),w.addedCount++,k++,w.removed.push(g[r]),r++):t===b?(w||(w=l(k,[],0)),w.addedCount++,k++):t===c&&(w||(w=l(k,[],0)),w.removed.push(g[r]),r++);return w&&x.push(w),x},n=function(a,b,c){var d,e;for(d=e=0;c>=0?c>e:e>c;d=c>=0?++e:--e)if(a[d]!==b[d])return d;return length},o=function(a,b,c){var d,e,f;for(e=a.length,f=b.length,d=0;c>d&&a[--e]===b[--f];)d++;return d},l=function(a,b,c){return{index:a,removed:b,addedCount:c}},p=function(a){var f,g,h,i,j,k,l,m;for(h=a.length-1,i=a[0].length-1,f=a[h][i],g=[];h>0||i>0;)0!==h?0!==i?(l=a[h-1][i-1],m=a[h-1][i],k=a[h][i-1],j=k>m?l>m?m:l:l>k?k:l,j===l?(l===f?g.push(d):(g.push(e),f=l),h--,i--):j===m?(g.push(c),h--,f=m):(g.push(b),i--,f=k)):(g.push(c),h--):(g.push(b),i--);return g.reverse(),g},f=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;for(l=f-e+1,g=c-b+1,h=new Array(l),i=n=0;l>=0?l>n:n>l;i=l>=0?++n:--n)h[i]=new Array(g),h[i][0]=i;for(j=o=0;g>=0?g>o:o>g;j=g>=0?++o:--o)h[0][j]=j;for(i=p=1;l>=1?l>p:p>l;i=l>=1?++p:--p)for(j=q=1;g>=1?g>q:q>g;j=g>=1?++q:--q)a[b+j-1]===d[e+i-1]?h[i][j]=h[i-1][j-1]:(k=h[i-1][j]+1,m=h[i][j-1]+1,h[i][j]=m>k?k:m);return h}}(this);var __slice=[].slice;!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return window.syncView=observers.sync,d=a.fn.bindTo=function(b){var c,e,f,g,h,i;for(g=this,b||(b={"this":{}}),b.hasOwnProperty("this")||(b={"this":b}),h=function(a,c){var d,e,f,g,h,i;for(e=Array.prototype.slice.call(a.get(0).attributes),h=0,i=e.length;i>h;h++)d=e[h],"data"===d.name.split("-").shift()&&(f=c[d.name.replace("data-","")],f&&(g=d.value,a.removeAttr(d.name),f(a,g,b)))},f="[data-"+Object.keys(d.blockHandlers).join("],[data-")+"]";(e=g.find(f)).length;)h(e.first(),d.blockHandlers);return i="[data-"+Object.keys(d.handlers).join("],[data-")+"]",c=g.filter(i).add(g.find(i)),c.each(function(){return h(a(this),d.handlers)}),g},d.blockHandlers={repeat:function(b,d,e){var f,g,h,i,j,k,l;return l=d.split(/\s+in\s+/),i=l[0],d=l[1],f=b.attr("data-controller"),b.removeAttr("data-controller"),j=e["this"]||e,k=b,b=a('<script type="text/repeat-placeholder"><!--data-repeat="'+d+'"--></script>').replaceAll(k),h=a(),g=function(a){var b,c,d;return d=k.clone(),b=f?chip.getController(f,{parent:j,element:d,model:a}):options.controller,c={"this":b},c[i]=a,d.bindTo(c),f&&"function"==typeof b.setup&&b.setup(),d.get(0)},c(b,d,e,function(c,d){return d?d.forEach(function(d){var e,f,i,j,k;for(f=[d.index,d.removed.length],j=[],e=d.index;e<d.index+d.addedCount;)i=c[e],j.push(g(i)),e++;return k=h.splice.apply(h,f.concat(j)),a(k).remove(),0===d.index?b.after(j):h.eq(d.index-1).after(j)}):(h.remove(),h=a(),Array.isArray(c)?(c.forEach(function(a){return h.push(g(a))}),b.after(h)):void 0)})},partial:function(a,b,d){return c(a,b,d,function(b){return a.html(b)})}},d.handlers={"if":function(a,b,d){return c(a,b,d,function(b){return b?a.show():a.hide()})},bind:function(a,b,d){return c(a,b,d,function(b){return a.text(null!=b?b:"")})},"bind-html":function(a,b,d){return c(a,b,d,function(b){return a.html(null!=b?b:"")})},active:function(b,d,e){var f,g;return d?c(b,d,e,function(a){return a?b.addClass("active"):b.removeClass("active")}):(g=function(){return f.length&&f.get(0).href===location.href?b.addClass("active"):b.removeClass("active")},f=b.filter('[href],[data-attr^="href:"]').add(b.children('[href],[data-attr^="href:"]')).first(),f.on("boundUpdate",g),a(document).on("urlchange",g),o(b,function(){return a(document).off("urlchange",g)}),g())},"class":function(a,b,d){return c(a,b,d,function(b){var c,d,e;if(Array.isArray(b)&&(b=b.join(" ")),"string"==typeof b)return a.attr("class",b);if(b&&"object"==typeof b){e=[];for(c in b)d=b[c],d?e.push(a.addClass(c)):e.push(a.removeClass(c));return e}})},value:function(a,b,d){var f;return c(a,b,d,function(b){return a.val(b)}),f=e(b+" = value",d,["value"]),f(a.val()),a.on("keyup",function(){return f(a.val()),syncView()})}},h=["click","dblclick","submit","change","focus","blur"],l={enter:13,esc:27},p=["checked","disabled"],b=["href","src"],h.forEach(function(a){return d.handlers["on"+a]=function(b,c,d){return b.on(a,function(a){return a.preventDefault(),g(c,d)})}}),Object.keys(l).forEach(function(a){var b;return b=l[a],d.handlers["on"+a]=function(a,c,d){return a.on("keydown",function(a){return a.keyCode===b?(a.preventDefault(),g(c,d)):void 0})}}),p.forEach(function(a){return d.handlers[a]=function(b,d,e){return c(b,d,e,function(c){return b.prop(a,c)})}}),b.forEach(function(a){return d.handlers[a]=function(b,d,e){return c(b,d,e,function(c){return null!=c?b.attr(a,c):b.removeAttr(a)})}}),Path.onchange=function(){return a(document).trigger("urlchange")},o=function(a,b){return a.on("removeObserver",b)},a.event.special.removeObserver={remove:function(a){return a.handler()}},q=/[a-z$_\$][a-z_\$0-9\.-]*\s*:?|'|"/gi,m=function(a,b){var c,d,e;for(b=b.concat(["this","window","true","false"]),e="",c=0;d=q.exec(a);)d&&(d=d[0],e+=a.slice(c,q.lastIndex-d.length),"'"===d||'"'===d?(c=a.indexOf(d,q.lastIndex)+1,e+=a.slice(q.lastIndex-1,c),q.lastIndex=c):"."===a[q.lastIndex-d.length-1]?(e+=d,c=q.lastIndex):(":"!==d.slice(-1)&&-1===b.indexOf(d.split(".").shift())&&(e+="this."),e+=d,c=q.lastIndex));return e+=a.slice(c)},c=function(a,b,c,d){var f,g;return g=function(b,c){return a.trigger("boundUpdate"),d(b,c)},f=observers.add(e(b,c),!0,g),o(a,function(){return f.close()}),f},n=function(a){return"this"!==a},j=function(a){return Object.keys(a).filter(n).sort()},k=function(a){return Object.keys(a).filter(n).sort().map(function(b){return a[b]})},i={},f=function(a,b,c){var d,e,f,g;if(d=j(b),c&&(d=d.concat(c)),a=m(a,d),f=i[a])return f;try{g=-1===a.indexOf("(")?"try{return "+a+"}catch(e){}":"return "+a,f=i[a]=Function.apply(null,__slice.call(d).concat([g]))}catch(h){throw e=h,'Error evaluating code for binding: "'+a+'" with error: '+e.message}return f},e=function(a,b,c){var d,e;return e=f(a,b,c),d=k(b),e.bind.apply(e,[b["this"]].concat(__slice.call(d)))},g=function(a,b){var c,d;return d=f(a,b),c=k(b),d.apply(b["this"],c)}}(jQuery);var __hasProp={}.hasOwnProperty;!function(a){var b;return b={templates:{},controllers:{},getTemplate:function(a){return $(b.templates[a])},getController:function(a,c){if(!b.controllers.hasOwnProperty(a))throw'Controller "'+a+'" does not exist';return new b.controllers[a](c)},controller:function(a,c){var d,e,f;null==c&&(c={}),d=function(){function b(b){null==b&&(b={}),this.name=a,this.parent=b.parent,this.model=b.model,this.element=b.element}return b}();for(e in c)__hasProp.call(c,e)&&(f=c[e],d.prototype[e]=f);return b.controllers[a]=d},runRoute:function(a,c){var d,e,f,g,h,i,j;for(g=["[data-route]"],i=0,j=c.length;j>i;i++)f=c[i],g.push("[data-route]");return g=g.join(" "),d=$(g),e=d.data("controller"),null!=e&&"function"==typeof e.teardown&&e.teardown(),e=b.getController(a),h=b.getTemplate(a),d.data("controller",e).html(h).bindTo(e),null!=e&&"function"==typeof e.setup&&e.setup(),syncView()},route:function(a,c,d){var e;return"function"==typeof c&&(d=c),"string"!=typeof c&&(c=a.replace(/^\//,"").replace(/\/\w/,function(a){return a.slice(1).toUpperCase()})),b.route.parents||(b.route.parents=[]),e=b.route.parents.slice(),e.length&&(a=e.join("")+a),Path.map(a).to(function(){return b.runRoute(c,e)}),d?(b.route.parents.push(a),d(b.route),b.route.parents.pop()):void 0},listen:function(){return Path.history.listen(),Path.history.supported?$("body").on("click","a[href]",function(a){return a.preventDefault(),Path.history.pushState({},"",$(this).attr("href"))}):void 0}},"function"==typeof define&&define.amd?define("chip",b):"object"==typeof exports&&"object"==typeof module?(a.chip=b,module.exports=b):a.chip=b}(this);